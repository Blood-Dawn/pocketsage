Metadata-Version: 2.4
Name: pocketsage
Version: 0.1.0
Summary: Offline Flask/Jinja2 finance and habit tracking app scaffold.
Author: PocketSage Framework Owner
Project-URL: Homepage, https://github.com/Blood-Dawn/pocketsage
Requires-Python: <3.13,>=3.11
Description-Content-Type: text/markdown
Requires-Dist: argon2-cffi==23.1.0
Requires-Dist: cryptography==43.0.1
Requires-Dist: flask==3.0.0
Requires-Dist: flet>=0.24.0
Requires-Dist: jinja2==3.1.4
Requires-Dist: matplotlib==3.8.4
Requires-Dist: pandas==2.2.2
Requires-Dist: pydantic==2.8.2
Requires-Dist: python-dotenv==1.0.1
Requires-Dist: sqlalchemy==2.0.32
Requires-Dist: sqlmodel==0.0.16
Provides-Extra: watcher
Requires-Dist: watchdog>=3.0.0; extra == "watcher"
Provides-Extra: dev
Requires-Dist: black==24.8.0; extra == "dev"
Requires-Dist: pytest==8.2.0; extra == "dev"
Requires-Dist: pytest-cov==5.0.0; extra == "dev"
Requires-Dist: pytest-xdist==3.6.1; extra == "dev"
Requires-Dist: ruff==0.6.2; extra == "dev"
Requires-Dist: pre-commit==3.8.0; extra == "dev"
Requires-Dist: bandit[toml]==1.7.9; extra == "dev"

# PocketSage ¬∑ Offline Finance + Habits Scaffold

Framework Owner checkpoint for the PocketSage desktop-first Flask app. Focus areas:
- üí∏ Ledger + budgeting (SQLModel)
- üîÅ Habit tracking with daily toggles
- üßæ Liabilities payoff snowball/avalanche
- üìà Portfolio CSV import (optional)
- üõ†Ô∏è Admin seed/reset/export workflows

> **Pattern** ‚Äì Methods, services, and docs include explicit `# TODO(@assignee)` markers. Teammates own implementations in follow-up PRs.

## Stack Snapshot
- Python 3.11, Flask app-factory + Blueprints + **Flet Desktop UI**
- SQLModel over SQLite with SQLCipher toggle
- Matplotlib PNG chart generation (server-rendered)
- **Flet** for cross-platform desktop UI (offline-first)
- pytest + ruff + black + pre-commit
- PyInstaller onefile packaging (Flask) + Flet Pack (Desktop)

## Quickstart

### Web Mode (Flask)
1. `python -m venv .venv && .venv\Scripts\activate` *(Windows)*
   - macOS/Linux: `python3 -m venv .venv && source .venv/bin/activate`
2. `pip install -e ".[dev]"`
3. `cp .env.example .env`
4. `python run.py`
5. Visit http://127.0.0.1:5000 to view the landing page and navigate to scaffolded blueprints

### Desktop Mode (Flet) ‚≠ê NEW
1. `python -m venv .venv && .venv\Scripts\activate` *(Windows)*
   - macOS/Linux: `python3 -m venv .venv && source .venv/bin/activate`
2. `pip install -e ".[dev]"`
3. `cp .env.example .env`
4. `python run_desktop.py`
5. The desktop app window will open automatically with Dashboard, Ledger, Budgets, Habits, Debts, Portfolio, and Settings

## Packaging

### Flask Web Mode
- The PyInstaller build mirrors `run.py`, which calls `create_app()` and then `app.run(debug=True)` for a development-friendly binary entry point.
- `make package` ‚Üí run PyInstaller using `PocketSage.spec` (outputs to `dist/`).
- Launch the bundled app the same way as the script (`./dist/PocketSage/PocketSage` on macOS/Linux, `dist\\PocketSage\\PocketSage.exe` on Windows) to confirm parity with local execution.

### Desktop Mode (Flet) ‚≠ê NEW
Build a standalone desktop executable using Flet Pack:

**Linux/macOS:**
```bash
bash scripts/build_desktop.sh
```

**Windows:**
```cmd
scripts\build_desktop.bat
```

The build script will:
1. Create/activate a virtual environment
2. Install all dependencies
3. Run tests
4. Package the app using `flet pack`
5. Output binary to `dist/` directory

**Launch the desktop app:**
- Windows: `dist\PocketSage\PocketSage.exe`
- macOS: `dist/PocketSage.app`
- Linux: `dist/PocketSage/PocketSage`

The desktop app is fully offline and stores all data in the same SQLite database as the Flask version (`instance/pocketsage.db`).

### Make Targets
- `make setup` ‚Üí install deps, enable pre-commit
- `make dev` ‚Üí run Flask dev server (web mode)
- `make test` ‚Üí pytest (currently skipped TODOs)
- `make lint` ‚Üí ruff + black check
- `make package` ‚Üí PyInstaller stub build (Flask)
- `make demo-seed` ‚Üí populate the local database with curated demo data

### Desktop App Commands
- `python run_desktop.py` ‚Üí run desktop app in development mode
- `bash scripts/build_desktop.sh` ‚Üí build desktop executable (Linux/macOS)
- `scripts\build_desktop.bat` ‚Üí build desktop executable (Windows)

#### No GNU Make? Use the setup script
Teams on platforms without GNU Make can run the equivalent bootstrap steps with the provided shell script:

```bash
# optional: override PYTHON or PIP to mirror the Makefile defaults
export PYTHON="python3"          # defaults to "python" if unset
export PIP="${PYTHON} -m pip"    # defaults to "$PYTHON -m pip" if unset

scripts/setup.sh
```

The script upgrades `pip`, installs the editable project with the `dev` extras (`pip install -e ".[dev]"`), and registers the repository hooks via `pre-commit install`, matching the `make setup` target.

## Configuration Flags
- `.env` values prefixed with `POCKETSAGE_`
- `POCKETSAGE_DATA_DIR=./instance` ships as the default entry in `.env.example`; leave it in place if you want PocketSage to manage the bundled `instance/` folder out of the box.
- `POCKETSAGE_USE_SQLCIPHER=true` switches DB URL builder (SQLCipher driver TODO)
- `POCKETSAGE_DATABASE_URL` overrides computed path if needed
- `_resolve_data_dir` respects `POCKETSAGE_DATA_DIR` and defaults to `instance/`; the directory is created during app factory
  initialization so the resolved path exists immediately afterwards. Use this location for SQLite files, local backup jobs,
  or cleanup scripts that prune historical exports.

`BaseConfig._resolve_data_dir()` expands the configured data path, creates the directory with `parents=True, exist_ok=True`, and then caches the resolved `Path` during startup. This means the `instance/` folder‚Äîand any custom directory you point to‚Äîwill be created automatically before the database URL is built.„ÄêF:pocketsage/config.py‚Ä†L25-L45„Äë

To store data somewhere else, override `POCKETSAGE_DATA_DIR` in your `.env` file with an absolute or relative path. Ensure the PocketSage process can read from and write to that location (for example, set directory permissions appropriately on Unix with `chmod`/`chown`, or run the app under a user that owns the target folder on Windows) so SQLite/SQLCipher files can be created successfully.„ÄêF:pocketsage/config.py‚Ä†L35-L45„Äë

## Privacy & Offline Notes
- All data stored locally under `instance/`
- No external APIs or telemetry
- SQLCipher support planned; see TODOs in `config.py` for key exchange

## Folder Highlights
- `src/pocketsage/` ‚Äì app factory, config, extensions, models, services
  - `blueprints/` ‚Äì Flask blueprints (web UI)
  - `templates/` ‚Äì Jinja2 templates (web UI)
  - `static/` ‚Äì CSS/JS assets (web UI)
  - `domain/` ‚Äì Repository protocols (domain layer) ‚≠ê NEW
  - `infra/` ‚Äì Database setup and repository implementations ‚≠ê NEW
  - `desktop/` ‚Äì Flet desktop UI (views, components, navigation) ‚≠ê NEW
- `scripts/` ‚Äì demo seeding, CSV samples, build scripts
- `docs/` ‚Äì architecture, code review, demo runbook, troubleshooting matrix, **Flet architecture** ‚≠ê NEW
- `tests/` ‚Äì pytest scaffolding with skips awaiting implementations

## Desktop App Features ‚≠ê NEW

The Flet desktop app provides a modern, cross-platform UI with:

### Screens
- **Dashboard** - Net worth, monthly income/expenses, total debt, active habits, quick actions
- **Ledger** - Transaction list with add/edit/delete, filtering, CSV import/export
- **Budgets** - Budget vs actual tracking with progress bars, monthly summaries
- **Habits** - Daily habit tracking with streaks and completion stats
- **Debts** - Liability management with snowball/avalanche projections
- **Portfolio** - Holdings tracking with cost basis and allocation
- **Settings** - Theme toggle, database management, data import/export

### Architecture
The desktop app follows a clean architecture pattern:

- **Domain Layer** (`src/pocketsage/domain/`) - Repository protocols and business logic interfaces
- **Infrastructure Layer** (`src/pocketsage/infra/`) - SQLModel repository implementations, database setup
- **Desktop UI Layer** (`src/pocketsage/desktop/`) - Flet views, components, and navigation

All domain logic (models, services, CSV import/export) is shared between Flask and Flet modes. See `docs/FLET_ARCHITECTURE.md` for detailed architecture documentation.

### Key Benefits
- ‚úÖ **Offline-first** - No internet required, all data local
- ‚úÖ **Cross-platform** - Windows, macOS, Linux from single codebase
- ‚úÖ **Shared logic** - Flask and Flet use same models and services
- ‚úÖ **Type-safe** - Full type annotations with Protocol-based dependency injection
- ‚úÖ **Testable** - Repository pattern enables easy unit testing

## Next Steps for Teammates
- ~~Replace repository protocols with SQLModel CRUD implementations~~ ‚úÖ **DONE**
- Implement Matplotlib chart rendering + native Flet charts
- Add CSV import/export UI to desktop app
- Wire watchdog optional observer when extra installed
- Fill Admin tasks, seeding, and export flows
- Add unit tests for repository implementations

See `TODO.md` for the full itemization with owners.

## Demo Data Seeding

Run the demo seeding script whenever you need a representative dataset for manual
testing:

- `make demo-seed`
- or `python scripts/seed_demo.py`

The script applies upserts instead of blind inserts so it can be executed
multiple times without duplicating rows. Categories are keyed by slug,
transactions by their synthetic `external_id`, habits by name (including habit
entries by date), and liabilities by name. This ensures the seed remains
idempotent while still refreshing values such as balances, descriptions, or
transaction memos on subsequent runs.
