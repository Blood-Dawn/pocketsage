{% extends 'base.html' %}
{% block title %}Ledger - PocketSage{% endblock %}

{% block content %}
  <section class="ledger-dashboard">
    <header class="ledger-header">
      <h1>Ledger</h1>
      <p class="ledger-subtitle">Monitor cash flow and stay ahead of upcoming spending.</p>
    </header>

    <form class="ledger-filters" method="get" action="{{ url_for('ledger.list_transactions') }}">
      <label>
        Start date
        <input type="date" name="start_date" value="{{ filter_state.start_date }}" />
      </label>
      <label>
        End date
        <input type="date" name="end_date" value="{{ filter_state.end_date }}" />
      </label>
      <label>
        Category
        <select name="category">
          <option value="" {% if filter_state.category == '' %}selected{% endif %}>All</option>
          {% for category in categories %}
            <option value="{{ category.id }}" {% if filter_state.category == category.id|string %}selected{% endif %}>
              {{ category.name }}
            </option>
          {% endfor %}
        </select>
      </label>
      <label>
        Search
        <input type="text" name="search" value="{{ filter_state.search }}" />
      </label>
      <button type="submit">Apply</button>
    </form>

    <section aria-label="Transactions">
      {% if transactions %}
        <table class="ledger-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Category</th>
              <th>Description</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody>
            {% for tx in transactions %}
              <tr>
                <td>{{ tx.occurred_at.strftime("%Y-%m-%d") if tx.occurred_at else "" }}</td>
                <td>{{ tx.category.name if tx.category else "" }}</td>
                <td>{{ tx.memo }}</td>
                <td>{{ "%.2f"|format(tx.amount) }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p>No transactions found for the selected filters.</p>
      {% endif %}
    </section>
  </section>
{% endblock %}
