{% extends 'base.html' %}
{% block title %}Habits Â· PocketSage{% endblock %}
{% block content %}
  <section class="habits-overview" data-habit-dashboard>
    <header class="habits-header">
      <h1>Habits</h1>
      <p class="habits-subtitle">Track daily completions and keep your streaks alive.</p>
    </header>

    <div class="habit-feedback" data-habit-flash-anchor></div>

    {% set habit_items = habits if habits is defined else [] %}
    {% if habit_items %}
      <ul class="habit-list" data-habit-list>
        {% for habit in habit_items %}
          {% set completed_today = habit.completed_today|default(false) %}
          {% set streak = habit.streak|default(0, true) %}
          <li class="habit-card" data-habit data-habit-id="{{ habit.id }}" data-completed-today="{{ 'true' if completed_today else 'false' }}">
            <div class="habit-card__summary">
              <h2 class="habit-card__title">{{ habit.name }}</h2>
              {% if habit.description %}
                <p class="habit-card__description">{{ habit.description }}</p>
              {% endif %}
            </div>
            <div class="habit-card__meta">
              <span class="habit-card__streak-label">Current streak</span>
              <span class="habit-card__streak-count" data-habit-streak-count>{{ streak }}</span>
            </div>
            <form method="post" action="{{ url_for('habits.toggle_habit', habit_id=habit.id) }}" class="habit-toggle-form" data-habit-toggle>
              {% if csrf_token is defined %}
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              {% endif %}
              <input type="hidden" name="target_state" value="{{ 'undo' if completed_today else 'complete' }}">
              <button type="submit" class="habit-toggle-button" data-habit-toggle-button>
                {{ 'Undo today' if completed_today else 'Mark complete' }}
              </button>
            </form>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="empty-state">No habits yet. Create one to start tracking streaks.</p>
    {% endif %}
  </section>
{% endblock %}
