{% extends 'base.html' %}
{% set edit_mode = is_edit %}
{% block title %}{% if edit_mode %}Edit Ledger Entry · PocketSage{% else %}Ledger Entry · PocketSage{% endif %}{% endblock %}
{% block content %}
  <article class="ledger-form">
    <header class="page-header">
      <h1>{% if edit_mode %}Edit Ledger Entry{% else %}Ledger Entry{% endif %}</h1>
      {% if edit_mode %}
        <nav class="page-actions">
          <a class="link-danger todo" href="#delete-transaction" aria-disabled="true">Delete entry</a>
        </nav>
      {% endif %}
    </header>

    {% if edit_mode and metadata %}
      <section class="ledger-metadata">
        <h2>Entry metadata</h2>
        <dl>
          {% if metadata.id %}
            <div><dt>ID</dt><dd>#{{ metadata.id }}</dd></div>
          {% endif %}
          {% if metadata.external_id %}
            <div><dt>External ID</dt><dd>{{ metadata.external_id }}</dd></div>
          {% endif %}
          {% if metadata.occurred_at %}
            <div><dt>Occurred</dt><dd>{{ metadata.occurred_at }}</dd></div>
          {% endif %}
          {% if metadata.amount %}
            <div><dt>Amount</dt><dd>{{ metadata.amount }} {{ metadata.currency or '' }}</dd></div>
          {% endif %}
          {% if metadata.account %}
            <div><dt>Account</dt><dd>{{ metadata.account }}</dd></div>
          {% endif %}
          {% if metadata.category_id %}
            <div><dt>Category</dt><dd>{{ metadata.category_id }}</dd></div>
          {% endif %}
          {% if metadata.created_at %}
            <div><dt>Created</dt><dd>{{ metadata.created_at }}</dd></div>
          {% endif %}
          {% if metadata.updated_at %}
            <div><dt>Updated</dt><dd>{{ metadata.updated_at }}</dd></div>
          {% endif %}
        </dl>
      </section>
    {% endif %}

    <form method="post" action="{{ form_action }}" class="ledger-entry-form">
      <fieldset>
        <legend class="sr-only">Ledger entry</legend>
        <div class="form-control">
          <label for="occurred_at">Occurred at</label>
          <input
            type="datetime-local"
            id="occurred_at"
            name="occurred_at"
            value="{{ form_values.occurred_at }}"
            required
          >
        </div>
        <div class="form-control">
          <label for="amount">Amount</label>
          <input
            type="number"
            id="amount"
            name="amount"
            step="0.01"
            value="{{ form_values.amount }}"
            required
          >
        </div>
        <div class="form-control">
          <label for="memo">Memo</label>
          <input
            type="text"
            id="memo"
            name="memo"
            maxlength="255"
            value="{{ form_values.memo }}"
          >
        </div>
        <div class="form-control">
          <label for="category_id">Category</label>
          <input
            type="number"
            id="category_id"
            name="category_id"
            value="{{ form_values.category_id }}"
          >
        </div>
      </fieldset>
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">
          {% if edit_mode %}Update entry{% else %}Create entry{% endif %}
        </button>
        <a class="btn" href="{{ list_url }}">Back to ledger</a>
      </div>
    </form>

    {% if form and form.memo %}
      <section class="form-summary">
        <h2>Current memo</h2>
        <p>{{ form.memo }}</p>
      </section>
    {% endif %}

    <p class="todo">TODO(@ledger-squad): build accessible form with categories + date picker.</p>
  </article>
{% endblock %}
