{% extends 'base.html' %}
{% block title %}Admin Â· PocketSage{% endblock %}
{% block content %}
  <section
    class="admin-dashboard"
    data-admin-dashboard
    data-job-status-endpoint="{{ url_for('admin.job_status', job_id='__JOB__') }}"
    data-initial-jobs='{{ jobs | tojson | safe }}'
  >
    <header class="admin-header">
      <h1>Admin Dashboard</h1>
      <p>Manage demo data, exports, and background jobs.</p>
    </header>

    <section class="admin-panel">
      <h2>Ledger Snapshot</h2>
      <dl class="admin-stats">
        <div>
          <dt>Total Transactions</dt>
          <dd>{{ stats.transactions }}</dd>
        </div>
        <div>
          <dt>Last Transaction</dt>
          <dd>
            {% if stats.last_transaction %}
              <time datetime="{{ stats.last_transaction }}">{{ stats.last_transaction }}</time>
            {% else %}
              <span class="empty">None recorded</span>
            {% endif %}
          </dd>
        </div>
      </dl>
    </section>

    <section class="admin-panel">
      <h2>Maintenance Actions</h2>
      <div class="admin-actions">
        <form method="post" action="{{ url_for('admin.seed_demo') }}" data-job-submit data-payload='{"confirm": true}'>
          <input type="hidden" name="confirm" value="1">
          <button type="submit" class="btn-primary">Seed Demo Data</button>
        </form>
        <form method="post" action="{{ url_for('admin.export_reports') }}" data-job-submit>
          <button type="submit" class="btn-secondary">Generate Export Bundle</button>
        </form>
      </div>
      <p class="hint">Actions run in the background; status appears below.</p>
    </section>

    <section class="admin-panel">
      <h2>Exports</h2>
      {% if exports %}
        <div class="exports-table-wrapper">
          <table class="exports-table">
            <thead>
              <tr>
                <th scope="col">Name</th>
                <th scope="col">Generated</th>
                <th scope="col">Size</th>
                <th scope="col" class="exports-actions">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for export in exports %}
                <tr>
                  <td data-label="Name"><code>{{ export.name }}</code></td>
                  <td data-label="Generated">
                    <time datetime="{{ export.modified_at }}">{{ export.modified_at }}</time>
                  </td>
                  <td data-label="Size">
                    <span title="{{ export.size }} bytes">{{ export.size | filesizeformat }}</span>
                  </td>
                  <td data-label="Actions" class="exports-action-cell">
                    <a class="btn-link" href="{{ export.download_url }}">Download</a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="empty exports-empty">No exports generated yet.</p>
      {% endif %}
    </section>

    <section class="admin-panel">
      <h2>Background Jobs</h2>
      <ul class="job-list" data-job-list>
        <!-- Populated via JavaScript -->
      </ul>
    </section>
  </section>
{% endblock %}
